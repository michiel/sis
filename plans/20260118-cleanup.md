# Warning cleanup plan (2026-01-18)

## Objective
Review the current compiler warnings, separate those that track lost functionality from those that stem from obsolete code, and lay out a remediation roadmap so the toolchain remains warning-free and the CLI surface is coherent.

## Warning review

### Lost functionality signals
- `crates/sis-pdf/src/main.rs` retains the old `run_detect`, `run_extract`, `run_export_*`, `extract_js`, `extract_embedded`, `embedded_filename`, `sanitize_embedded_filename`, `entry_dict`, `extract_obj_bytes`, `string_bytes`, `magic_type` helpers and the `Objects` query enum variant even though their owning commands were removed (cargo build warns at lines ~3513‑4926). Those functions represent features (detection shortcuts, exports, extraction helpers) that should either be reinstated through the query interface phases 2‑3 or formally deleted so the repository only holds active code.
- The ML provider selection code in `crates/sis-pdf/src/main.rs` keeps mutable locals (`provider_detection_note`, `provider_available`, `provider_selected`) that are unused after the refactor (cargo warnings around 1576‑1640). These warnings hint that the previously richer provider selection flow was partly dropped; we need to decide whether to revive that UX or remove the vestigial variables.

### Obsolete code signals
- `crates/font-analysis` has dozens of unused imports, constants, helper structs/functions across `color_fonts.rs`, `dynamic/ttf_vm.rs`, `variable_fonts.rs`, `woff.rs`, and `signatures.rs` (cargo warnings about unused imports and dead code). The entire crate currently compiles but does not exercise these bits, so we should either wire them into actual analysis routines or delete them to avoid misleading maintenance burden.
- `crates/sis-pdf-core/src/report.rs` defines unused render helpers and tree structures (warnings near lines 759‑1564) plus the `LinkEdge.reason` field, implying that the richer report formatting path was removed/bypassed. Unless the feature is returning soon, the dead helpers should be pruned.
- `tools/cve-update/src/main.rs` carries unused struct fields (`NvdResponse.results_per_page`, `CveItem.published`); they are likely leftovers from earlier API parsing and can be stripped or flagged for future use.
- `crates/sis-pdf/src/commands/query.rs` extends `Query::Objects` and `impact_from_severity()` without any consumer (warnings around 12 and 558), so either the object-introspection query must be implemented soon or the stubs removed until it exists.

## Cleanup roadmap
1. **Align CLI surface with the query architecture** – build or document replacements for each warning-linked feature:
   - Phase 2/3 of the query plan must ingest logic from `run_detect`, `run_extract`, and the export helpers. If the replacement path is delayed, delete the unused helpers and add reference tests describing the planned query (e.g., `sis query js`).
   - Review the unused `Objects` query variant and `impact_from_severity()`: either hook them into the executor/formatter and cover them with a regression test, or drop them and note the future scope in `plans/20260112-query-implementation-summary.md`.
   - Decide whether the ML provider selection helpers are needed; if not, remove the mutable placeholders to silence warnings.

2. **Prune or repurpose dead font-analysis/reporting helpers** – audit each unused import/constant/function identified by `cargo build`. For helpers that are still part of the roadmap (e.g., hinting analysis) move them into a dedicated `TODO` module or gate them behind `#[cfg(feature = "font-analysis")]`; for the rest, delete them and ensure the public API surface remains minimal.

3. **Keep tooling clean** – trim the unused JSON fields in `tools/cve-update` or clearly document why they remain; add focused tests if replacements are reintroduced.

4. **Validation pass** – after each cleanup step, run `cargo build` and `cargo test` to confirm the relevant warnings disappear and that the remaining code compiles without regressions. Capture regression-proof commands in this plan for future reference.

## Testing
- `cargo build`
- `cargo test` (especially `font-analysis` and `sis-pdf-core` suites once code touched)

